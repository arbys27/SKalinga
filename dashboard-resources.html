<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKalinga - Resources & Lending</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Your shared dashboard CSS -->
    <link rel="stylesheet" href="assets/css/dashboard.css">

    <style>
        /* User Profile Card - Themed Design */
        .user-profile-card {
            position: relative;
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.88) 100%);
            border-radius: 14px;
            border: 2px solid rgba(93, 173, 226, 0.3);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(93, 173, 226, 0.15);
            backdrop-filter: blur(10px);
        }

        .user-profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(93, 173, 226, 0.1));
            border-radius: 14px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .user-profile-card:hover::before {
            opacity: 1;
        }

        .user-profile-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(93, 173, 226, 0.25);
            border-color: rgba(93, 173, 226, 0.6);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.92) 100%);
        }

        .user-avatar-new {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #FF6B9D 0%, #5DADE2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 4px 16px rgba(93, 173, 226, 0.3);
            transition: all 0.3s ease;
        }

        .user-profile-card:hover .user-avatar-new {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(93, 173, 226, 0.4);
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        #userFullName {
            font-size: 15px;
            font-weight: 700;
            color: #222;
            margin: 0;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .user-role-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #228B57 0%, #1a6b43 100%);
            color: #A8E6CF;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(34, 139, 87, 0.2);
            transition: all 0.3s ease;
        }

        .user-profile-card:hover .user-role-badge {
            box-shadow: 0 4px 12px rgba(34, 139, 87, 0.3);
            transform: translateY(-1px);
        }

        /* Custom styles for Resources page */
        .nav-item.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }
    </style>
    
</head>
<body>

<div class="app-container">
        <aside class="sidebar">
            <div class="logo-section">
                <div class="logo-content">
                    <div class="logo-icons-group">
                        <img src="assets/images/logosanantonio.jpg" alt="San Antonio Logo" class="official-logo">
                        <img src="assets/images/sklogo.jpg" alt="SK Logo" class="official-logo">
                    </div>
                    <div class="logo-text">
                        <h1>SKalinga Admin</h1>
                        <p>San Antonio</p>
                    </div>
                </div>
            </div>

            <nav class="nav-section">
                <div class="nav-group">
                    <div class="nav-group-title">Overview</div>
                    <a href="admin-dashboard.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Dashboard
                    </a>
                    <a href="admin-dashboard.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        Analytics
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Management</div>
                    <a href="youth-registry.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Youth Registry
                    </a>
                    <a href="dashboard-events.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Events
                        <span class="nav-badge">3</span>
                    </a>
                    <a href="dashboard-resources.html" class="nav-item active">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        </svg>
                        Resources
                    </a>
                    <a href="dashboard-printing.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                        Printing
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">Emergency</div>
                    <a href="dashboard-incidents.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        Incidents
                        <span class="nav-badge">7</span>
                    </a>
                    <a href="dashboard-health.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                        </svg>
                        Health Services
                    </a>
                </div>

                <div class="nav-group">
                    <div class="nav-group-title">System</div>
                    <a href="dashboard-settings.html" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        Settings
                    </a>
                    <a href="api/logout.php" class="nav-item">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-header">
                <div class="header-left">
                    <h2>Resources & Lending</h2>
                    <p id="dashboard-datetime">Loading date and time...</p>
                </div>
                <div class="header-right">
                    <div class="user-profile-card">
                        <div class="user-avatar-new" id="userAvatarInitials">--</div>
                        <div class="user-details">
                            <h4 id="userFullName">Loading...</h4>
                            <span class="user-role-badge" id="userRole">Administrator</span>
                        </div>
                    </div>
                </div>
            </header>

        <div class="dashboard-content">
            <div class="search-filter-bar">
                <div class="search-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="ðŸ” Search by item, borrower...">
                    <select id="filterStatus" class="filter-select">
                        <option value="">All Status</option>
                        <option value="Borrowed">Borrowed</option>
                        <option value="Returned">Returned</option>
                        <option value="Overdue">Overdue</option>
                    </select>
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="btn-add-youth" id="scanQrBtn">
                        <i class="fas fa-qrcode"></i> Scan Youth QR
                    </button>
                    <button class="btn-add-youth" id="addItemBtn">
                        <i class="fas fa-plus"></i> Add Item
                    </button>
                </div>
            </div>

            <table class="admin-table" id="lendingTable">
                <thead>
    <tr>
        <th>Item ID</th>  <!-- New column for unique item identifier -->
        <th>Item Name</th>  <!-- Renamed from "Item" for clarity -->
        <th>Member ID</th>  <!-- New column for youth ID -->
        <th>Borrower Name</th>  <!-- New column for borrower name -->
        <th>Borrow Date</th>
        <th>Due Date</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>
</thead>
                <tbody id="lendingTableBody"></tbody>
            </table>
        </div>
    </main>

</div>

<!-- Add/Edit Item Modal -->
<div class="modal" id="addItemModal">
    <div class="modal-content">
        <span class="close-modal" id="closeItemModal">Ã—</span>
        <h2 id="itemModalTitle">Add New Borrowable Item</h2>

        <form id="itemForm">
            <input type="hidden" id="editItemId">

            <div class="form-group">
                <label for="itemName">Item Name *</label>
                <input type="text" id="itemName" placeholder="Projector, Microphone, Basketball..." required>
            </div>

            <div class="form-group">
                <label for="itemDescription">Description</label>
                <textarea id="itemDescription" placeholder="Brand, condition, notes..."></textarea>
            </div>

            <div class="form-group">
                <label for="itemQuantity">Quantity Available *</label>
                <input type="number" id="itemQuantity" min="1" value="1" required>
            </div>

            <button type="submit" class="btn-submit">Save Item</button>
        </form>
    </div>
</div>

<!-- Scan QR Modal -->
<div class="modal" id="scanQrModal">
    <div class="modal-content">
        <span class="close-modal" id="closeScanModal">Ã—</span>
        <h2>Scan Youth QR Code</h2>
        <p>Scan the member's Digital Youth ID to auto-fill details.</p>

        <div style="text-align: center; margin: 24px 0;">
            <p style="font-size: 18px; color: #555;">Scan the QR code or enter Youth ID manually</p>
            <input type="text" id="manualYouthId" placeholder="Scan QR or enter Youth ID (e.g. SK-2024-XXXX)" style="width: 80%; max-width: 400px; padding: 12px; font-size: 16px;" autofocus>
            <button id="lookupYouthBtn" class="btn-submit" style="margin-top: 16px;">Lookup & Proceed</button>
        </div>

        <div id="borrowerInfo" class="borrower-info" style="display: none;"></div>

        <div id="borrowForm" style="display: none;">
            <form id="borrowFormElement">
                <input type="hidden" id="borrowYouthId">

                <div class="form-group">
                    <label for="borrowItem">Select Item to Borrow *</label>
                    <select id="borrowItem" required></select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="borrowDate">Borrow Date *</label>
                        <input type="date" id="borrowDate" required>
                    </div>
                    <div class="form-group">
                        <label for="dueDate">Due Date *</label>
                        <input type="date" id="dueDate" required>
                    </div>
                </div>

                <button type="submit" class="btn-submit">Confirm Borrow</button>
            </form>
        </div>
    </div>
</div>

<!-- View Lending Record Modal -->
<div class="modal" id="viewLendingModal">
    <div class="modal-content">
        <span class="close-modal" id="closeViewLending">Ã—</span>
        <h2>Lending Record Details</h2>

        <div id="lendingDetails" class="event-details"></div>
    </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Date & Time
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDashboardDateTime() {
    const el = document.getElementById('dashboard-datetime');
    if (!el) return;
    const now = new Date();
    el.textContent = now.toLocaleString('en-US', {
        weekday: 'long', month: 'long', day: 'numeric', year: 'numeric',
        hour: 'numeric', minute: '2-digit', hour12: true
    });
}
setInterval(updateDashboardDateTime, 1000);
updateDashboardDateTime();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Data
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let youthData = JSON.parse(localStorage.getItem('youthData')) || [];

let itemsData = JSON.parse(localStorage.getItem('skResources')) || [
    { id: "ITEM-001", name: "Projector", description: "Epson 1080p", quantity: 2, available: 2 },
    { id: "ITEM-002", name: "Wireless Microphone", description: "Shure", quantity: 4, available: 4 },
    { id: "ITEM-003", name: "Basketball", description: "Molten official size", quantity: 5, available: 5 }
];

let lendingData = JSON.parse(localStorage.getItem('skLending')) || [];

function saveData() {
    localStorage.setItem('skResources', JSON.stringify(itemsData));
    localStorage.setItem('skLending', JSON.stringify(lendingData));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Render Lending Table
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLendingTable(filtered = lendingData) {
    const tbody = document.getElementById('lendingTableBody');
    tbody.innerHTML = '';

    filtered.forEach(record => {
        const borrowDate = new Date(record.borrowDate);
        const dueDate = new Date(record.dueDate);
        const today = new Date();
        let status = "Borrowed";
        let statusClass = "status-borrowed";

        if (record.returned) {
            status = "Returned";
            statusClass = "status-returned";
        } else if (dueDate < today) {
            status = "Overdue";
            statusClass = "status-overdue";
        }

        const borrower = youthData.find(y => y.id === record.youthId) || { first: "Unknown", last: "" };

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${record.itemId}</td>  <!-- New: Display item ID -->
            <td>${record.itemName}</td>  <!-- Updated: Now just the item name -->
            <td>${record.youthId}</td>  <!-- New: Display member ID separately -->
            <td>${borrower.first} ${borrower.last}</td>  <!-- New: Display borrower name separately -->
            <td>${borrowDate.toLocaleDateString()}</td>
            <td>${dueDate.toLocaleDateString()}</td>
            <td><span class="status-badge ${statusClass}">${status}</span></td>
            <td class="action-buttons">
                <button class="action-btn btn-view" onclick="viewLending('${record.id}')" title="View Details">
                    <i class="fas fa-eye"></i>
                </button>
                ${!record.returned ? `<button class="action-btn btn-return" onclick="returnItem('${record.id}')" title="Mark as Returned">
                    <i class="fas fa-undo"></i>
                </button>` : ''}
                <button class="action-btn btn-delete" onclick="deleteLending('${record.id}')" title="Delete Record">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Search & Filter Lending
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterLending() {
    const search = document.getElementById('searchInput').value.toLowerCase().trim();
    const status = document.getElementById('filterStatus').value;

    const filtered = lendingData.filter(r => {
        const text = `${r.itemName} ${r.youthId}`.toLowerCase();
        const matchesSearch = text.includes(search);
        const matchesStatus = !status || 
            (status === "Borrowed" && !r.returned && new Date(r.dueDate) >= new Date()) ||
            (status === "Returned" && r.returned) ||
            (status === "Overdue" && !r.returned && new Date(r.dueDate) < new Date());

        return matchesSearch && matchesStatus;
    });

    renderLendingTable(filtered);
}

document.getElementById('searchInput')?.addEventListener('input', filterLending);
document.getElementById('filterStatus')?.addEventListener('change', filterLending);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Modal Controls
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const addItemModal = document.getElementById('addItemModal');
const scanQrModal = document.getElementById('scanQrModal');
const viewLendingModal = document.getElementById('viewLendingModal');

document.getElementById('addItemBtn').onclick = () => {
    document.getElementById('itemModalTitle').textContent = "Add New Borrowable Item";
    document.getElementById('itemForm').reset();
    addItemModal.style.display = 'flex';
};

document.getElementById('scanQrBtn').onclick = () => {
    document.getElementById('borrowerInfo').style.display = 'none';
    document.getElementById('borrowForm').style.display = 'none';
    document.getElementById('manualYouthId').value = '';
    scanQrModal.style.display = 'flex';
};

document.getElementById('closeItemModal').onclick = () => addItemModal.style.display = 'none';
document.getElementById('closeScanModal').onclick = () => scanQrModal.style.display = 'none';
document.getElementById('closeViewLending').onclick = () => viewLendingModal.style.display = 'none';

window.onclick = e => {
    if (e.target.classList.contains('modal')) e.target.style.display = 'none';
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Add / Edit Item
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('itemForm').addEventListener('submit', e => {
    e.preventDefault();

    const id = `ITEM-${String(Date.now()).slice(-6)}`;

    const item = {
        id,
        name: document.getElementById('itemName').value.trim(),
        description: document.getElementById('itemDescription').value.trim(),
        quantity: parseInt(document.getElementById('itemQuantity').value),
        available: parseInt(document.getElementById('itemQuantity').value)
    };

    itemsData.push(item);
    saveData();

    addItemModal.style.display = 'none';
    alert("Item added successfully!");
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Scan / Lookup Youth
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('lookupYouthBtn').onclick = () => {
    const inputId = document.getElementById('manualYouthId').value.trim().toUpperCase();
    if (!inputId) return alert("Please enter a Youth ID");

    const youth = youthData.find(y => y.id.toUpperCase() === inputId);
    if (!youth) return alert("Youth ID not found");

    document.getElementById('borrowerInfo').innerHTML = `
        <strong>Found:</strong> ${youth.first} ${youth.last}<br>
        <strong>ID:</strong> ${youth.id}<br>
        <strong>Contact:</strong> ${youth.contact || 'N/A'}
    `;
    document.getElementById('borrowerInfo').style.display = 'block';
    document.getElementById('borrowYouthId').value = youth.id;

    // Populate available items
    const select = document.getElementById('borrowItem');
    select.innerHTML = '<option value="" disabled selected>Select item</option>';
    itemsData.filter(i => i.available > 0).forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.id;
        opt.textContent = `${item.name} (${item.available} available)`;
        select.appendChild(opt);
    });

    document.getElementById('borrowForm').style.display = 'block';
};

// Auto-lookup on valid ID input (for QR scanner)
document.getElementById('manualYouthId').addEventListener('input', function() {
    const inputId = this.value.trim().toUpperCase();
    const idPattern = /^SK-\d{4}-\d{4}$/;
    if (idPattern.test(inputId)) {
        // Valid ID format, auto-lookup
        setTimeout(() => {
            document.getElementById('lookupYouthBtn').click();
        }, 500); // Small delay to allow full input
    }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Borrow Item
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('borrowFormElement').addEventListener('submit', e => {
    e.preventDefault();

    const youthId = document.getElementById('borrowYouthId').value;
    const itemId = document.getElementById('borrowItem').value;
    const borrowDate = document.getElementById('borrowDate').value;
    const dueDate = document.getElementById('dueDate').value;

    if (!itemId) return alert("Please select an item");

    const item = itemsData.find(i => i.id === itemId);
    if (item.available < 1) return alert("No more available units");

    item.available -= 1;

    const record = {
        id: `LEND-${Date.now()}`,
        youthId,
        itemId,
        itemName: item.name,
        borrowDate,
        dueDate,
        returned: false
    };

    lendingData.push(record);
    saveData();

    scanQrModal.style.display = 'none';
    renderLendingTable();
    filterLending();

    alert("Item borrowed successfully!");
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Return Item
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function returnItem(id) {
    if (!confirm("Mark this item as returned?")) return;

    const record = lendingData.find(r => r.id === id);
    if (record) {
        record.returned = true;
        const item = itemsData.find(i => i.id === record.itemId);
        if (item) item.available += 1;
    }

    saveData();
    renderLendingTable();
    filterLending();

    alert("Item marked as returned!");
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Delete Lending Record
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function deleteLending(id) {
    if (!confirm("Delete this lending record?")) return;

    lendingData = lendingData.filter(r => r.id !== id);
    saveData();
    renderLendingTable();
    filterLending();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// View Lending Record
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function viewLending(id) {
    const record = lendingData.find(r => r.id === id);
    if (!record) return alert("Record not found");

    const youth = youthData.find(y => y.id === record.youthId) || { first: "Unknown", last: "" };
    const borrowDate = new Date(record.borrowDate).toLocaleDateString();
    const dueDate = new Date(record.dueDate).toLocaleDateString();

    document.getElementById('lendingDetails').innerHTML = `
        <p><strong>Item:</strong> ${record.itemName}</p>
        <p><strong>Borrower:</strong> ${youth.first} ${youth.last} (${record.youthId})</p>
        <p><strong>Borrow Date:</strong> ${borrowDate}</p>
        <p><strong>Due Date:</strong> ${dueDate}</p>
        <p><strong>Status:</strong> ${record.returned ? 'Returned' : (new Date(record.dueDate) < new Date() ? 'Overdue' : 'Borrowed')}</p>
    `;

    viewLendingModal.style.display = 'flex';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Load User Profile
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadUserProfile() {
    try {
        const response = await fetch('api/get_user_profile.php');
        const result = await response.json();
        
        if (result.success) {
            const user = result.user;
            document.getElementById('userAvatarInitials').textContent = user.initials;
            document.getElementById('userFullName').textContent = user.name;
            document.getElementById('userRole').textContent = user.role;
        } else {
            console.error('Error loading user profile:', result.error);
            document.getElementById('userFullName').textContent = 'Guest User';
        }
    } catch (error) {
        console.error('Error fetching user profile:', error);
        document.getElementById('userFullName').textContent = 'Guest User';
    }
}

window.addEventListener('load', () => {
    loadUserProfile();
    renderLendingTable();
    filterLending();
});
</script>
</body>
</html>