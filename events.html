<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SKalinga - Announcements & Updates</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="assets/css/global.css">
  <link rel="stylesheet" href="assets/css/portal.css">
  <link rel="stylesheet" href="assets/css/events.css">

  <!-- Professional Loader System -->
  <link rel="stylesheet" href="assets/css/loader.css">
</head>
<body>

<div class="app-container">

  <!-- Back Button (Top-Left) -->
  <button class="back-btn" onclick="window.location.href='youth-portal.html'">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 12H5"></path>
      <path d="M12 19l-7-7 7-7"></path>
    </svg>
  </button>

  <!-- Top Navigation â€“ Centered with Logos on Both Sides -->
  <nav class="top-nav" style="padding: 24px 32px;">
    <div class="logo-area" style="display: flex; align-items: center; justify-content: center; gap: 24px; width: 100%;">
      <img src="assets/images/logosanantonio.jpg" alt="San Antonio Logo" class="official-logo" style="width: 64px; height: 64px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 16px rgba(0,0,0,0.15);">
      <div class="logo-text" style="text-align: center;">
        <h1 style="font-size: 36px; font-weight: 800; color: var(--primary-green); margin: 0; line-height: 1;">SKalinga</h1>
        <p style="font-size: 15px; color: var(--text-gray); margin: 4px 0 0; font-weight: 500;">Youth Portal</p>
      </div>
      <img src="assets/images/sklogo.jpg" alt="SK Logo" class="official-logo" style="width: 64px; height: 64px; border-radius: 50%; object-fit: cover; border: 4px solid white; box-shadow: 0 4px 16px rgba(0,0,0,0.15);">
    </div>
  </nav>

  <!-- Page Header -->
  <header class="page-header">
    <h1>SK Announcements</h1>
    <p>Stay updated with latest news, events, advisories, and programs from SKalinga Youth</p>
  </header>

  <!-- Filters -->
  <div class="filters-bar">
    <div class="search-filter">
      <input type="text" placeholder="Search announcements..." />
    </div>
    <div class="filter-buttons">
      <button class="filter-btn active">All</button>
      <button class="filter-btn">Recent</button>
      <button class="filter-btn">Events</button>
      <button class="filter-btn">Advisories</button>
      <button class="filter-btn">Programs</button>
    </div>
  </div>

  <!-- Announcements Grid -->
  <div class="events-grid" id="eventsGrid">
    <!-- Events will be rendered here dynamically -->
  </div>

  <!-- No Events Message -->
  <div id="noEventsMessage" style="display: none; padding: 60px 20px; text-align: center;">
    <div style="font-size: 48px; margin-bottom: 16px;">ðŸ“­</div>
    <h3 style="font-size: 22px; color: #1a1a2e; margin-bottom: 8px;">No Events Found</h3>
    <p style="color: #666; font-size: 16px;">Check back soon for upcoming announcements and events!</p>
  </div>

  <!-- Details Modal -->
  <div class="details-modal" id="detailsModal">
    <div class="modal-content">
      <div class="modal-header">
        <img id="modalImage" src="" alt="Post image">
        <button class="close-btn" onclick="closeDetailsModal()">Ã—</button>
        <div class="type-badge" id="modalTypeBadge">Event</div>
      </div>
      <div class="modal-body">
        <h2 id="modalTitle">Post Title</h2>
        <p class="modal-meta" id="modalDate">Date and Location</p>
        <p class="modal-description" id="modalDescription">Full description goes here</p>
      </div>
      <div class="modal-footer" id="modalFooter">
        <!-- Form button renders here conditionally -->
      </div>
    </div>
  </div>


</div>

<script>
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Load User Profile
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadUserProfile() {
    try {
      const response = await fetch('api/get_user_profile.php');
      const result = await response.json();
      
      if (result.success) {
        const user = result.user;
        document.getElementById('userAvatarInitials').textContent = user.initials;
        document.getElementById('userFullName').textContent = user.name;
        document.getElementById('userRole').textContent = user.role;
      } else {
        console.error('Error loading user profile:', result.error);
        document.getElementById('userFullName').textContent = 'Guest User';
      }
    } catch (error) {
      console.error('Error fetching user profile:', error);
      document.getElementById('userFullName').textContent = 'Guest User';
    }
  }
  
  // Load profile on page load
  window.addEventListener('load', async () => {
    loadUserProfile();
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Event Type to Badge Mapping
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const eventTypeBadgeMap = {
    'Training': 'event',
    'Seminar': 'event',
    'Sports': 'program',
    'Tournament': 'program',
    'Cultural': 'announcement',
    'Festival': 'announcement',
    'Community': 'advisory',
    'Service': 'advisory',
    'Other': 'event'
  };

  // Placeholder images for different event types
  const placeholderImages = {
    'event': 'https://images.unsplash.com/photo-1522202176988-66273c2b033f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    'program': 'https://images.unsplash.com/photo-1541532713592-79a0317b6b77?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    'announcement': 'https://images.unsplash.com/photo-1581092160560-4c9d3a0d8d5c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    'advisory': 'https://images.unsplash.com/photo-1552664730-d307ca884978?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
  };

  // Load events from localStorage
  let allEvents = JSON.parse(localStorage.getItem('skalingaEvents')) || [];
  let filteredEvents = [];
  let currentFilter = 'All';

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Load events from API
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadEventsFromAPI() {
    try {
      const response = await fetch('api/get_events.php');
      const result = await response.json();
      
      if (result.success) {
        allEvents = result.data || [];
        performSearch();
      } else {
        console.error('Failed to load events:', result.error);
      }
    } catch (error) {
      console.error('Error fetching events:', error);
    }
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Format Date and Time
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function formatEventDateTime(date, time) {
    const dateObj = new Date(`${date}T${time}`);
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
    
    const dayOfWeek = days[dateObj.getDay()];
    const timeStr = dateObj.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    
    return {
      dateObj,
      day: dateObj.getDate(),
      month: months[dateObj.getMonth()],
      dayOfWeek,
      time: timeStr,
      formatted: `${dayOfWeek}, ${timeStr} â€¢ ${dateObj.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}`
    };
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Get Event Status
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getEventStatus(date, time, eventStatus) {
    const eventDateTime = new Date(`${date}T${time}`);
    const now = new Date();
    
    // Use admin-set status if available
    if (eventStatus === 'Ongoing') return 'Ongoing';
    if (eventStatus === 'Past') return 'Past';
    
    // Otherwise determine from date
    if (eventDateTime < now) return 'Past';
    if (eventDateTime.toDateString() === now.toDateString()) return 'Ongoing';
    return 'Upcoming';
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Render Events Grid
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderEventsGrid(events) {
    const grid = document.getElementById('eventsGrid');
    const noMsg = document.getElementById('noEventsMessage');
    
    if (events.length === 0) {
      grid.innerHTML = '';
      noMsg.style.display = 'block';
      return;
    }
    
    noMsg.style.display = 'none';
    grid.innerHTML = '';

    events.forEach(event => {
      const dateTime = formatEventDateTime(event.date, event.time);
      const badgeType = eventTypeBadgeMap[event.type] || 'event';
      const eventStatus = getEventStatus(event.date, event.time, event.status);
      // Use uploaded image if available, otherwise use placeholder
      const image = event.imagePath || placeholderImages[badgeType];

      const card = document.createElement('div');
      card.className = `event-card ${eventStatus.toLowerCase()}`;
      card.dataset.type = badgeType;
      card.dataset.title = event.title;
      card.dataset.date = `${dateTime.dayOfWeek}, ${dateTime.time}${event.endTime ? ` - ${event.endTime}` : ''} â€¢ ${dateTime.formatted}`;
      card.dataset.description = event.description || `Join us for ${event.title}!`;
      card.dataset.image = image;
      card.dataset.formUrl = event.regLink || '';
      card.dataset.eventId = event.id;
      card.dataset.capacity = event.capacity || '';
      card.dataset.registeredCount = event.registeredCount || 0;
      card.dataset.endTime = event.endTime || '';

      const capacityText = event.capacity ? `${event.registeredCount || 0}/${event.capacity}` : '';
      
      card.innerHTML = `
        <div class="event-image">
          <img src="${image}" alt="${event.title}">
          <div class="event-date-badge">
            <span class="day">${dateTime.day}</span>
            <span class="month">${dateTime.month}</span>
          </div>
          <div class="post-type-badge ${badgeType}">${event.type}</div>
        </div>
        <div class="event-content">
          <h3>${event.title}</h3>
          <p class="event-time-location">${dateTime.dayOfWeek}, ${dateTime.time} â€¢ ${event.location}</p>
          ${event.capacity ? `<p class="event-capacity" style="font-size: 12px; color: #666; margin: 4px 0;">ðŸ‘¥ ${capacityText} registered</p>` : ''}
          <p class="event-desc">${event.description || `Join us for this exciting event!`}</p>
          <div class="event-footer">
            <button class="btn primary small" onclick="openDetailsModal(this)">Learn More</button>
          </div>
        </div>
      `;

      grid.appendChild(card);
    });
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Search Functionality
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function performSearch() {
    const query = document.querySelector('.search-filter input').value.toLowerCase().trim();
    
    // Filter to only show upcoming/current events
    const now = new Date();
    let toFilter = allEvents.filter(event => {
      const eventDateTime = new Date(`${event.date}T${event.time}`);
      // Show events from today onwards
      return eventDateTime >= new Date(now.getFullYear(), now.getMonth(), now.getDate());
    });
    
    // Apply type filter
    if (currentFilter !== 'All') {
      if (currentFilter === 'Events') {
        toFilter = toFilter.filter(e => eventTypeBadgeMap[e.type] === 'event');
      } else if (currentFilter === 'Advisories') {
        toFilter = toFilter.filter(e => eventTypeBadgeMap[e.type] === 'advisory');
      } else if (currentFilter === 'Programs') {
        toFilter = toFilter.filter(e => eventTypeBadgeMap[e.type] === 'program');
      } else if (currentFilter === 'Recent') {
        toFilter = toFilter.sort((a, b) => new Date(`${b.date}T${b.time}`) - new Date(`${a.date}T${a.time}`));
      }
    }
    
    // Apply search query
    if (query) {
      toFilter = toFilter.filter(event => {
        const searchText = `${event.id} ${event.title} ${event.location} ${event.type} ${event.description}`.toLowerCase();
        return searchText.includes(query);
      });
    }

    filteredEvents = toFilter;
    renderEventsGrid(filteredEvents);
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Filter Button Functionality
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      currentFilter = btn.textContent.trim();
      performSearch();
    });
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Search Input Listener
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.querySelector('.search-filter input').addEventListener('input', performSearch);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Modal Functions
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openDetailsModal(button) {
    const card = button.closest('.event-card');
    const modal = document.getElementById('detailsModal');
    
    const title = card.dataset.title;
    const date = card.dataset.date;
    const description = card.dataset.description;
    const image = card.dataset.image;
    const type = card.dataset.type;
    const formUrl = card.dataset.formUrl;
    const capacity = card.dataset.capacity;
    const registeredCount = card.dataset.registeredCount;
    const endTime = card.dataset.endTime;

    // Populate modal content
    document.getElementById('modalImage').src = image;
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalDate').textContent = date;
    
    // Add capacity info to description if available
    let descriptionHTML = description;
    if (capacity) {
      const remaining = parseInt(capacity) - parseInt(registeredCount || 0);
      descriptionHTML += `<br><br><strong>Capacity:</strong> ${registeredCount}/${capacity} registered${remaining > 0 ? ` (${remaining} slots available)` : ' (Full)'}`;
    }
    document.getElementById('modalDescription').innerHTML = descriptionHTML;
    
    // Update type badge
    const typeBadge = document.getElementById('modalTypeBadge');
    typeBadge.textContent = card.querySelector('.post-type-badge').textContent;
    typeBadge.className = 'type-badge ' + type;

    // Handle form button (conditional rendering)
    const footer = document.getElementById('modalFooter');
    footer.innerHTML = ''; // Clear previous content
    
    if (formUrl && formUrl.trim() !== '') {
      const formButton = document.createElement('button');
      formButton.className = 'btn primary small';
      formButton.textContent = 'Register Now';
      formButton.onclick = () => {
        window.open(formUrl, '_blank');
      };
      footer.appendChild(formButton);
    }

    // Show modal
    modal.classList.add('active');
  }

  function closeDetailsModal() {
    const modal = document.getElementById('detailsModal');
    modal.classList.remove('active');
  }

  // Close modal when clicking outside
  document.getElementById('detailsModal').addEventListener('click', (e) => {
    if (e.target.id === 'detailsModal') {
      closeDetailsModal();
    }
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Initialize on Load
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('DOMContentLoaded', async () => {
    await loadEventsFromAPI();
  });

  // Refresh events every minute to update status
  setInterval(async () => {
    await loadEventsFromAPI();
  }, 60000); // Update every minute
</script>

<!-- Professional Loader System -->
<script src="assets/js/loader.js"></script>
</body>
</html>