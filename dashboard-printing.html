<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKalinga - Printing Services Management</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Your shared dashboard CSS -->
    <link rel="stylesheet" href="assets/css/dashboard.css">

    <!-- Page-specific styles -->
    <style>
        /* User Profile Card - Themed Design */
        .user-profile-card {
            position: relative;
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.88) 100%);
            border-radius: 14px;
            border: 2px solid rgba(93, 173, 226, 0.3);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(93, 173, 226, 0.15);
            backdrop-filter: blur(10px);
        }

        .user-profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(93, 173, 226, 0.1));
            border-radius: 14px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .user-profile-card:hover::before {
            opacity: 1;
        }

        .user-profile-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(93, 173, 226, 0.25);
            border-color: rgba(93, 173, 226, 0.6);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.92) 100%);
        }

        .user-avatar-new {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #FF6B9D 0%, #5DADE2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 4px 16px rgba(93, 173, 226, 0.3);
            transition: all 0.3s ease;
        }

        .user-profile-card:hover .user-avatar-new {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(93, 173, 226, 0.4);
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        #userFullName {
            font-size: 15px;
            font-weight: 700;
            color: #222;
            margin: 0;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .user-role-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #228B57 0%, #1a6b43 100%);
            color: #A8E6CF;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(34, 139, 87, 0.2);
            transition: all 0.3s ease;
        }

        .user-profile-card:hover .user-role-badge {
            box-shadow: 0 4px 12px rgba(34, 139, 87, 0.3);
            transform: translateY(-1px);
        }

        /* Custom styles for Printing page */
        .nav-item.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        /* Additional styles for printing-specific elements */
        .btn-add-youth {
            background: #228B57;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add-youth:hover { background: #1a6b43; }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-group.half {
            flex: 1;
            min-width: 200px;
        }

        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            border-color: #228B57;
            background: rgba(34,139,87,0.05);
        }

        .uploaded-files {
            display: none;
        }

        .uploaded-files.show {
            display: block;
        }

        .uploaded-file-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }

        .scan-container {
            text-align: center;
        }

        .verified-info {
            background: #d4edda;
            padding: 16px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .btn-submit {
            width: 100%;
            padding: 14px;
            background: #228B57;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        .btn-submit:hover {
            background: #1a6b43;
        }

        .btn-download {
            background: #17a2b8;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
        }

        .btn-download:hover {
            background: #138496;
        }

        #fileInput {
            display: none;
        }

        /* Action Buttons - Enhanced UX */
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .action-btn:active::before {
            width: 100px;
            height: 100px;
        }

        /* View Button */
        .btn-view {
            background: linear-gradient(135deg, #5DADE2 0%, #3498DB 100%);
            color: white;
        }

        .btn-view:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(93, 173, 226, 0.4);
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
        }

        .btn-view:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(93, 173, 226, 0.3);
        }

        /* Scan Button */
        .btn-scan {
            background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
            color: white;
        }

        .btn-scan:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(155, 89, 182, 0.4);
            background: linear-gradient(135deg, #8E44AD 0%, #7D3C98 100%);
        }

        .btn-scan:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(155, 89, 182, 0.3);
        }

        /* Delete Button */
        .btn-delete {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
        }

        .btn-delete:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(231, 76, 60, 0.4);
            background: linear-gradient(135deg, #C0392B 0%, #A93226 100%);
        }

        .btn-delete:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }

        /* Disabled State */
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn:disabled:hover {
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Tooltip Enhancement */
        .action-btn[title]::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .action-btn[title]::before-tooltip {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-2px);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(0, 0, 0, 0.85);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .action-btn:hover[title]::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-16px);
        }

        .action-btn:hover[title]::before-tooltip {
            opacity: 1;
        }

        /* Mobile Responsive - Increase touch target */
        @media (max-width: 768px) {
            .action-btn {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            .action-buttons {
                gap: 12px;
            }
        }

        /* Toast Notification Styles */
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            max-width: 380px;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            font-size: 14px;
            font-weight: 500;
            border-left: 4px solid;
        }

        .toast.success {
            border-left-color: #27AE60;
        }

        .toast.success .toast-icon {
            color: #27AE60;
        }

        .toast.error {
            border-left-color: #E74C3C;
        }

        .toast.error .toast-icon {
            color: #E74C3C;
        }

        .toast.warning {
            border-left-color: #F39C12;
        }

        .toast.warning .toast-icon {
            color: #F39C12;
        }

        .toast.info {
            border-left-color: #5DADE2;
        }

        .toast.info .toast-icon {
            color: #5DADE2;
        }

        .toast-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            color: #333;
        }

        .toast.removing {
            animation: slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            #toastContainer {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .toast {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="app-container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-section">
            <div class="logo-content">
                <div class="logo-icons-group">
                    <img src="assets/images/logosanantonio.jpg" alt="San Antonio Logo" class="official-logo">
                    <img src="assets/images/sklogo.jpg" alt="SK Logo" class="official-logo">
                </div>
                <div class="logo-text">
                    <h1>SKalinga Admin</h1>
                    <p>San Antonio</p>
                </div>
            </div>
        </div>

        <nav class="nav-section">
            <div class="nav-group">
                <div class="nav-group-title">Overview</div>
                <a href="admin-dashboard.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Dashboard
                </a>
                <a href="admin-dashboard.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    Analytics
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Management</div>
                <a href="youth-registry.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Youth Registry
                </a>
                <a href="dashboard-events.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Events
                </a>
                <a href="dashboard-resources.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    </svg>
                    Resources
                </a>
                <a href="dashboard-printing.html" class="nav-item active">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    Printing
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Emergency</div>
                <a href="dashboard-incidents.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Incidents
                </a>

                <a href="dashboard-health.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                    Health Services
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">System</div>
                <a href="dashboard-settings.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    Settings
                </a>
                <a href="api/logout.php" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-header">
            <div class="header-left">
                <h2>Printing Services Management</h2>
                <p id="dashboard-datetime">Loading date and time...</p>
            </div>
            <div class="header-right">
                <div class="user-profile-card">
                    <div class="user-avatar-new" id="userAvatarInitials">--</div>
                    <div class="user-details">
                        <h4 id="userFullName">Loading...</h4>
                        <span class="user-role-badge" id="userRole">Administrator</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="dashboard-content">
            <div class="search-filter-bar">
                <div class="search-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="ðŸ” Search by member ID, name...">
                    <select id="filterStatus" class="filter-select">
                        <option value="">All Status</option>
                        <option value="Pending">Pending</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <button class="btn-add-youth" onclick="location.reload()" style="background: #5DADE2;">
                        <i class="fas fa-sync-alt"></i> Refresh Requests
                    </button>
                </div>
            </div>  

            <table class="admin-table" id="printingTable">
                <thead>
                    <tr>
                        <th>Member ID</th>
                        <th>Name</th>
                        <th>Date & Time Sent</th>
                        <th>Status</th>
                        <th>Documents</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="printingTableBody"></tbody>
            </table>
        </div>
    </main>

</div>

<!-- Add Print Request Modal -->
<div class="modal" id="addRequestModal">
    <div class="modal-content">
        <span class="close-modal" id="closeAddRequest">Ã—</span>
        <h2>New Print/Xerox Request</h2>

        <form id="addRequestForm">
            <input type="hidden" id="editRequestId">

            <!-- Request Type -->
            <div class="form-group">
                <label for="requestType">Request Type *</label>
                <select id="requestType" required>
                    <option value="" disabled selected>Select type</option>
                    <option value="Print">Print</option>
                    <option value="Xerox">Xerox (Photocopy)</option>
                </select>
            </div>

            <!-- Member ID -->
            <div class="form-group">
                <label for="memberId">Member ID *</label>
                <input type="text" id="memberId" placeholder="SK-2024-0789" required>
            </div>

            <!-- File Upload Area -->
            <div class="form-group full">
                <label>Select File to Print *</label>
                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p><strong>Choose File</strong> or drag and drop</p>
                    <small>Allowed: PDF, Word, JPG, PNG, TXT â€¢ Max 10MB</small>
                    <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt" required>
                </div>
                <div class="uploaded-files" id="uploadedFiles">
                    <div class="uploaded-file-item" id="uploadedFileName">
                        <i class="fas fa-file"></i>
                        <span id="fileName">No file selected</span>
                    </div>
                </div>
            </div>

            <!-- Number of Pages & Print Type -->
            <div class="form-row">
                <div class="form-group half">
                    <label for="pages">Number of Pages *</label>
                    <input type="number" id="pages" min="1" placeholder="e.g., 5" required>
                </div>
                <div class="form-group half">
                    <label for="printType">Print Type *</label>
                    <select id="printType" required>
                        <option value="" disabled selected>Select type</option>
                        <option value="Black & White">Black & White</option>
                        <option value="Colored">Colored</option>
                    </select>
                </div>
            </div>

            <!-- Purpose -->
            <div class="form-group">
                <label for="purpose">Purpose of Printing *</label>
                <select id="purpose" required>
                    <option value="" disabled selected>Select purpose</option>
                    <option value="Academics / School Requirements">Academics / School Requirements</option>
                    <option value="Personal / Resume">Personal / Resume</option>
                    <option value="Event Poster / Flyer">Event Poster / Flyer</option>
                    <option value="Business / Application">Business / Application</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <button type="submit" class="btn-submit">Send Document for Printing</button>
        </form>
    </div>
</div>

<!-- Scan QR Modal -->
<div class="modal" id="scanQrModal">
    <div class="modal-content">
        <span class="close-modal" id="closeScanQr">Ã—</span>
        <h2>Scan Youth Digital ID QR Code</h2>

        <div class="scan-container">
            <p style="color: #666; margin-bottom: 20px;">
                <i class="fas fa-qrcode" style="font-size: 32px; color: #9B59B6; margin-bottom: 12px; display: block;"></i>
                Scan or enter the youth member's Digital ID. Auto-lookup & auto-complete after verification.
            </p>
            
            <input type="text" id="scanQrInput" class="search-input" placeholder="Scan or Type Member ID (e.g., SK-2024-0789)" style="text-transform: uppercase; width: 100%; max-width: 400px; font-size: 16px;">
            
            <button id="verifyQrBtn" class="btn-submit" style="background: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%); margin-top: 16px; display: none;">
                <i class="fas fa-check-circle"></i> Verify & Complete
            </button>

            <div id="verifiedSection" style="display: none;">
                <div class="verified-info">
                    <h3>
                        <i class="fas fa-check-circle" style="color: #28a745;"></i>
                        âœ“ Youth Verified & Processing
                    </h3>
                    <p><strong>Member ID:</strong> <span id="verifiedId"></span></p>
                    <p><strong>Name:</strong> <span id="verifiedName"></span></p>
                    <p><strong>Contact:</strong> <span id="verifiedContact"></span></p>
                    <p style="margin-top: 12px; font-size: 13px; color: #666;"><i class="fas fa-spinner fa-spin"></i> Marking as completed...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Youth Request Details Modal -->
<div class="modal" id="youthRequestModal">
    <div class="modal-content">
        <span class="close-modal" id="closeYouthRequest">Ã—</span>
        <h2>Youth Print Request Details</h2>

        <div id="youthRequestContent" class="details-info"></div>

        <!-- Document Preview Section -->
        <div class="document-section" id="documentSection" style="margin: 24px 0;">
            <h3 style="color: #228B57; font-size: 18px; margin-bottom: 12px;">
                <i class="fas fa-file-alt"></i> Documents Submitted
            </h3>
            <div class="document-preview" id="youthDocPreview">
                <i class="fas fa-file-pdf" style="font-size: 48px; color: #dc3545; margin-bottom: 12px;"></i>
                <p id="docFileName" style="font-weight: 600; margin: 8px 0;">resume.pdf</p>
                <small style="color: #666;">5 pages â€¢ PDF Document</small>
            </div>
            <button class="btn-download" id="downloadYouthDoc" style="width: 100%; margin-top: 12px;">
                <i class="fas fa-download"></i> Download Document for Printing
            </button>
        </div>

        <div style="margin-top: 32px; text-align: center;">
            <button class="btn-submit" id="confirmPrintBtn" style="background: #28a745;">
                <i class="fas fa-check-circle"></i> Confirm & Mark as Finished
            </button>
        </div>
    </div>
</div>

<!-- View Details Modal -->
<div class="modal" id="viewDetailsModal">
    <div class="modal-content">
        <span class="close-modal" id="closeViewDetails">Ã—</span>
        <h2>Print Request Details</h2>

        <div id="detailsContent" class="details-info"></div>

        <div class="document-preview" id="docPreview"></div>

        <button class="btn-download" id="downloadBtn">
            <i class="fas fa-download"></i> Download Documents
        </button>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer"></div>

<!-- Confirmation Modal -->
<div class="modal" id="confirmationModal">
    <div class="modal-content" style="max-width: 420px;">
        <h2 style="margin-bottom: 12px; color: #E74C3C;">
            <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i> Confirm Action
        </h2>
        <p id="confirmMessage" style="color: #666; margin: 0 0 28px 0; font-size: 15px; line-height: 1.5;"></p>
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button id="confirmCancelBtn" class="btn-submit" style="background: #95A5A6; width: auto; margin: 0; padding: 10px 24px;">
                Cancel
            </button>
            <button id="confirmOkBtn" class="btn-submit" style="background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%); width: auto; margin: 0; padding: 10px 24px;">
                <i class="fas fa-trash" style="margin-right: 6px;"></i> Delete
            </button>
        </div>
    </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Live Date & Time
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDashboardDateTime() {
    const el = document.getElementById('dashboard-datetime');
    if (!el) return;
    const now = new Date();
    const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    const day = days[now.getDay()];
    const month = months[now.getMonth()];
    const date = now.getDate();
    const year = now.getFullYear();
    let hour = now.getHours();
    let min = now.getMinutes();
    let ampm = 'AM';
    if (hour >= 12) { ampm = 'PM'; if (hour > 12) hour -= 12; }
    if (hour === 0) hour = 12;
    min = min < 10 ? '0' + min : min;
    el.textContent = `${day}, ${month} ${date}, ${year} â€¢ ${hour}:${min} ${ampm}`;
}
setInterval(updateDashboardDateTime, 1000);
updateDashboardDateTime();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Toast Notification
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showAlert(message, type = 'info') {
    const container = document.getElementById('toastContainer');
    
    let icon = 'âœ“';
    if (type === 'error') {
        icon = 'âŒ';
    } else if (type === 'warning') {
        icon = 'âš ï¸';
    } else if (type === 'info') {
        icon = 'â„¹ï¸';
    }
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <span class="toast-icon">${icon}</span>
        <span class="toast-message">${message}</span>
    `;
    
    container.appendChild(toast);
    
    // Auto-remove after 4 seconds
    setTimeout(() => {
        toast.classList.add('removing');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 4000);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Confirmation Modal
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showConfirm(message, onConfirm) {
    const confirmModal = document.getElementById('confirmationModal');
    const confirmMessage = document.getElementById('confirmMessage');
    const confirmOkBtn = document.getElementById('confirmOkBtn');
    const confirmCancelBtn = document.getElementById('confirmCancelBtn');
    
    confirmMessage.textContent = message;
    confirmModal.style.display = 'flex';
    
    confirmOkBtn.onclick = () => {
        confirmModal.style.display = 'none';
        if (onConfirm) onConfirm();
    };
    
    confirmCancelBtn.onclick = () => {
        confirmModal.style.display = 'none';
    };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Data Management (Database-Driven)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let printRequests = [];

async function loadPrintRequests() {
    try {
        const response = await fetch('api/get_print_requests.php');
        const result = await response.json();
        
        if (result.success) {
            printRequests = result.data || [];
            renderPrintTable(printRequests);
        } else {
            console.error('Error loading print requests:', result.error);
            document.getElementById('printingTableBody').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">No print requests found</td></tr>';
        }
    } catch (error) {
        console.error('Error fetching print requests:', error);
        document.getElementById('printingTableBody').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Error loading requests</td></tr>';
    }
}

function renderPrintTable(filtered = printRequests) {
    const tbody = document.getElementById('printingTableBody');
    tbody.innerHTML = '';

    if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">No print requests found</td></tr>';
        return;
    }

    filtered.forEach(req => {
        const dateTime = new Date(req.created_at).toLocaleString('en-US', {dateStyle: 'short', timeStyle: 'short'});
        const statusClass = req.status === 'Pending' ? 'status-pending' : 'status-completed';

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">${req.member_id}</td>
            <td style="font-weight: 600;">${req.member_name}</td>
            <td>${dateTime}</td>
            <td><span class="status-badge ${statusClass}">${req.status}</span></td>
            <td><a href="${req.file_path}" target="_blank" download style="color: #5DADE2; text-decoration: none;"><i class="fas fa-download"></i> ${req.file_name}</a></td>
            <td class="action-buttons">
                <button class="action-btn btn-view" onclick="viewDetails(${req.request_id})" title="View Details">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn btn-scan" onclick="openQrScanForRequest(${req.request_id}, '${req.member_id}')" title="Scan Youth ID & Verify">
                    <i class="fas fa-qrcode"></i>
                </button>
                <button class="action-btn btn-delete" onclick="deleteRequest(${req.request_id})" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}


function filterTable() {
    const search = document.getElementById('searchInput').value.toLowerCase().trim();
    const status = document.getElementById('filterStatus').value;

    const filtered = printRequests.filter(req => {
        const text = `${req.member_id} ${req.member_name} ${req.file_name} ${req.document_title}`.toLowerCase();
        return text.includes(search) && (!status || req.status === status);
    });

    renderPrintTable(filtered);
}

document.getElementById('searchInput')?.addEventListener('input', filterTable);
document.getElementById('filterStatus')?.addEventListener('change', filterTable);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// File Upload Handler
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('fileInput')?.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('uploadedFiles').classList.add('show');
    }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Modal Controls
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const viewModal = document.getElementById('viewDetailsModal');

document.getElementById('closeViewDetails').onclick = () => viewModal.style.display = 'none';

window.onclick = e => {
    if (e.target.classList.contains('modal')) e.target.style.display = 'none';
};



// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// View Details
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function viewDetails(requestId) {
    const req = printRequests.find(r => r.request_id == requestId);
    if (!req) return showAlert('Request not found', 'error');

    const dateTime = new Date(req.created_at).toLocaleString('en-US', {dateStyle: 'full', timeStyle: 'short'});

    document.getElementById('detailsContent').innerHTML = `
        <p><strong>Request ID:</strong> REQ-${req.request_id}</p>
        <p><strong>Member ID:</strong> ${req.member_id}</p>
        <p><strong>Name:</strong> ${req.member_name}</p>
        <p><strong>Document Title:</strong> ${req.document_title}</p>
        <p><strong>Date & Time Sent:</strong> ${dateTime}</p>
        <p><strong>Print Type:</strong> ${req.print_type || 'N/A'}</p>
        <p><strong>Paper Size:</strong> ${req.paper_size || 'N/A'}</p>
        <p><strong>Copies:</strong> ${req.copies || '1'}</p>
        <p><strong>Status:</strong> <span class="status-badge status-${req.status.toLowerCase()}">${req.status}</span></p>
    `;

    document.getElementById('docPreview').innerHTML = `
        <a href="${req.file_path}" target="_blank" download style="color: #5DADE2; text-decoration: none;">
            <i class="fas fa-download"></i> ${req.file_name}
        </a>
    `;

    document.getElementById('downloadBtn').onclick = () => {
        const a = document.createElement('a');
        a.href = req.file_path;
        a.download = req.file_name;
        a.click();
    };

    viewModal.style.display = 'flex';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Update Status Helper
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function updateStatus(requestId, newStatus) {
    const req = printRequests.find(r => r.request_id == requestId);
    if (!req) return alert("Request not found");

    try {
        const response = await fetch('api/update_print_status.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ request_id: requestId, status: newStatus })
        });
        const result = await response.json();
        
        if (result.success) {
            showAlert(`Status updated to ${newStatus}!`, 'success');
            viewModal.style.display = 'none';
            loadPrintRequests();
        } else {
            showAlert(`${result.message || 'Failed to update status'}`, 'error');
        }
    } catch (error) {
        console.error('Error updating status:', error);
        showAlert('Error updating status', 'error');
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// QR Scan for Request Verification
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentScanRequestId = null;
let currentScanMemberId = null;

function openQrScanForRequest(requestId, memberId) {
    currentScanRequestId = requestId;
    currentScanMemberId = memberId;
    
    // Clear previous input
    document.getElementById('scanQrInput').value = '';
    document.getElementById('verifiedSection').style.display = 'none';
    document.getElementById('scanQrInput').focus();
    
    // Open modal
    document.getElementById('scanQrModal').style.display = 'flex';
}

// Auto-verify on input change (real-time lookup)
document.getElementById('scanQrInput')?.addEventListener('input', async function(e) {
    const scannedId = this.value.trim().toUpperCase();
    
    // Only proceed if we have a complete ID
    if (!scannedId || scannedId.length < 5) {
        document.getElementById('verifiedSection').style.display = 'none';
        return;
    }
    
    if (scannedId !== currentScanMemberId?.toUpperCase()) {
        document.getElementById('verifiedSection').style.display = 'none';
        return;
    }
    
    // Auto-verify with real-time lookup
    await verifyAndCompleteQrScan(scannedId);
});

// Verify button as fallback
document.getElementById('verifyQrBtn')?.addEventListener('click', async function() {
    const scannedId = document.getElementById('scanQrInput').value.trim().toUpperCase();
    
    if (!scannedId) {
        return showAlert('Please enter or scan the Member ID', 'warning');
    }
    
    if (scannedId !== currentScanMemberId?.toUpperCase()) {
        return showAlert('Member ID does not match! Expected: ' + currentScanMemberId, 'error');
    }
    
    await verifyAndCompleteQrScan(scannedId);
});

// Combined verification and auto-complete function
async function verifyAndCompleteQrScan(scannedId) {
    try {
        const response = await fetch('api/get_user.php?member_id=' + encodeURIComponent(scannedId));
        const result = await response.json();
        
        if (result.success && result.user) {
            const user = result.user;
            
            // Display verified info
            document.getElementById('verifiedId').textContent = user.member_id;
            document.getElementById('verifiedName').textContent = user.name;
            document.getElementById('verifiedContact').textContent = user.phone_number || user.email || 'N/A';
            document.getElementById('verifiedSection').style.display = 'block';
            
            // Auto-complete after short delay
            setTimeout(() => {
                completeAfterQrScan();
            }, 1200);
        } else {
            showAlert('Youth member not found in system', 'error');
            document.getElementById('verifiedSection').style.display = 'none';
        }
    } catch (error) {
        console.error('Error verifying youth:', error);
        showAlert('Error verifying youth member', 'error');
        document.getElementById('verifiedSection').style.display = 'none';
    }
}

function completeAfterQrScan() {
    if (!currentScanRequestId) return;
    
    const req = printRequests.find(r => r.request_id == currentScanRequestId);
    if (!req) return showAlert('Request not found', 'error');
    
    // Mark as Completed with single scan
    updateStatus(currentScanRequestId, 'Completed');
    
    // Close modal after successful completion
    setTimeout(() => {
        document.getElementById('scanQrModal').style.display = 'none';
        currentScanRequestId = null;
        currentScanMemberId = null;
    }, 500);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Delete Request
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function deleteRequest(requestId) {
    showConfirm('Are you sure you want to delete this request? This action cannot be undone.', async () => {
        try {
            const response = await fetch('api/delete_print_request.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ request_id: requestId })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert('Request deleted successfully.', 'success');
                loadPrintRequests();
            } else {
                showAlert(`${result.message || 'Failed to delete request'}`, 'error');
            }
        } catch (error) {
            console.error('Error deleting request:', error);
            showAlert('Error deleting request. Please try again.', 'error');
        }
    });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Load User Profile
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadUserProfile() {
    try {
        const response = await fetch('api/get_user_profile.php');
        const result = await response.json();
        
        if (result.success) {
            const user = result.user;
            document.getElementById('userAvatarInitials').textContent = user.initials;
            document.getElementById('userFullName').textContent = user.name;
            document.getElementById('userRole').textContent = user.role;
        } else {
            console.error('Error loading user profile:', result.error);
            document.getElementById('userFullName').textContent = 'Guest User';
        }
    } catch (error) {
        console.error('Error fetching user profile:', error);
        document.getElementById('userFullName').textContent = 'Guest User';
    }
}

window.addEventListener('load', () => {
    loadUserProfile();
    loadPrintRequests();
});

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('searchInput')?.addEventListener('input', filterTable);
    document.getElementById('filterStatus')?.addEventListener('change', filterTable);
    
    // Close modals on X button
    document.getElementById('closeScanQr')?.addEventListener('click', () => {
        document.getElementById('scanQrModal').style.display = 'none';
        currentScanRequestId = null;
        currentScanMemberId = null;
    });
});
</script>
</body>
</html>