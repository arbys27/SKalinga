<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKalinga - Events Management</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Your shared dashboard CSS -->
    <link rel="stylesheet" href="assets/css/dashboard.css">

    <style>
        /* User Profile Card - Themed Design */
        .user-profile-card {
            position: relative;
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.88) 100%);
            border-radius: 14px;
            border: 2px solid rgba(93, 173, 226, 0.3);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(93, 173, 226, 0.15);
            backdrop-filter: blur(10px);
        }

        /* Animated gradient border on hover */
        .user-profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(93, 173, 226, 0.1));
            border-radius: 14px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .user-profile-card:hover::before {
            opacity: 1;
        }

        .user-profile-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(93, 173, 226, 0.25);
            border-color: rgba(93, 173, 226, 0.6);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.92) 100%);
        }

        /* Avatar */
        .user-avatar-new {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: linear-gradient(135deg, #FF6B9D 0%, #5DADE2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 4px 16px rgba(93, 173, 226, 0.3);
            transition: all 0.3s ease;
        }

        .user-profile-card:hover .user-avatar-new {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(93, 173, 226, 0.4);
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .user-greeting {
            font-size: 11px;
            color: #5DADE2;
            font-weight: 600;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            opacity: 0.85;
        }

        #userFullName {
            font-size: 15px;
            font-weight: 700;
            color: #222;
            margin: 0;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .user-role-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #228B57 0%, #1a6b43 100%);
            color: #A8E6CF;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            width: fit-content;
            box-shadow: 0 2px 8px rgba(34, 139, 87, 0.2);
            transition: all 0.3s ease;
        }

        .user-profile-card:hover .user-role-badge {
            box-shadow: 0 4px 12px rgba(34, 139, 87, 0.3);
            transform: translateY(-1px);
        }

        /* Toast Notification Styles */
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            max-width: 380px;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            font-size: 14px;
            font-weight: 500;
            border-left: 4px solid;
        }

        .toast.success {
            border-left-color: #27AE60;
        }

        .toast.success .toast-icon {
            color: #27AE60;
        }

        .toast.error {
            border-left-color: #E74C3C;
        }

        .toast.error .toast-icon {
            color: #E74C3C;
        }

        .toast.warning {
            border-left-color: #F39C12;
        }

        .toast.warning .toast-icon {
            color: #F39C12;
        }

        .toast.info {
            border-left-color: #5DADE2;
        }

        .toast.info .toast-icon {
            color: #5DADE2;
        }

        .toast-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .toast-message {
            flex: 1;
            color: #333;
        }

        .toast.removing {
            animation: slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            #toastContainer {
                top: 10px;
                right: 10px;
                left: 10px;
            }

            .toast {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .user-profile-card {
                padding: 12px 16px;
                gap: 12px;
            }

            .user-avatar-new {
                width: 44px;
                height: 44px;
                font-size: 14px;
            }

            #userFullName {
                font-size: 14px;
            }

            .user-greeting {
                font-size: 10px;
            }

            .user-role-badge {
                font-size: 9px;
                padding: 3px 9px;
            }
        }
    </style>
    
</head>
<body>

<div class="app-container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-section">
            <div class="logo-content">
                <div class="logo-icons-group">
                    <img src="assets/images/logosanantonio.jpg" alt="San Antonio Logo" class="official-logo">
                    <img src="assets/images/sklogo.jpg" alt="SK Logo" class="official-logo">
                </div>
                <div class="logo-text">
                    <h1>SKalinga Admin</h1>
                    <p>San Antonio</p>
                </div>
            </div>
        </div>

        <nav class="nav-section">
            <div class="nav-group">
                <div class="nav-group-title">Overview</div>
                <a href="admin-dashboard.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Dashboard
                </a>
                <a href="admin-dashboard.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    Analytics
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Management</div>
                <a href="youth-registry.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Youth Registry
                </a>
                <a href="dashboard-events.html" class="nav-item active">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Events
                </a>
                <a href="dashboard-resources.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    </svg>
                    Resources
                </a>
                <a href="dashboard-printing.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    Printing
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Emergency</div>
                <a href="dashboard-incidents.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Incidents
                </a>

                <a href="dashboard-health.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                    Health Services
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">System</div>
                <a href="dashboard-settings.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    Settings
                </a>
                <a href="api/logout.php" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-header">
            <div class="header-left">
                <h2>Events Management</h2>
                <p id="dashboard-datetime">Loading date and time...</p>
            </div>
            <div class="header-right">
                <div class="user-profile-card">
                    <div class="user-avatar-new" id="userAvatarInitials">--</div>
                    <div class="user-details">
                        <h4 id="userFullName">Loading...</h4>
                        <span class="user-role-badge" id="userRole">Administrator</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="dashboard-content">
            <div class="search-filter-bar">
                <div class="search-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="üîç Search by title, location...">
                    <select id="filterStatus" class="filter-select">
                        <option value="">All Status</option>
                        <option value="Upcoming">Upcoming</option>
                        <option value="Ongoing">Ongoing</option>
                        <option value="Past">Past</option>
                    </select>
                </div>
                <button class="btn-add-event" id="addEventBtn">
                    <i class="fas fa-plus"></i> Add New Event
                </button>
            </div>

            <table class="admin-table" id="eventsTable">
                <thead>
                    <tr>
                        <th>Event ID</th>
                        <th>Title</th>
                        <th>Date & Time</th>
                        <th>Location</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Registration Link</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="eventsTableBody"></tbody>
            </table>
        </div>
    </main>

</div>

<!-- Add/Edit Event Modal -->
<div class="modal" id="addEventModal">
    <div class="modal-content">
        <span class="close-modal" id="closeEventModal">√ó</span>
        <h2 id="eventModalTitle">Add New Event</h2>

        <form id="eventForm">
            <input type="hidden" id="editEventId">

            <div class="form-group">
                <label for="eventTitle">Event Title *</label>
                <input type="text" id="eventTitle" placeholder="Youth Leadership Summit" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="eventDate">Date *</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label for="eventStartTime">Start Time *</label>
                    <input type="time" id="eventStartTime" required>
                </div>
                <div class="form-group">
                    <label for="eventEndTime">End Time</label>
                    <input type="time" id="eventEndTime">
                </div>
            </div>

            <div class="form-group">
                <label for="eventLocation">Location *</label>
                <input type="text" id="eventLocation" placeholder="Barangay Hall, San Antonio" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="eventType">Event Type *</label>
                    <select id="eventType" required>
                        <option value="" disabled selected>Select type</option>
                        <option value="Training">Training / Seminar</option>
                        <option value="Sports">Sports / Tournament</option>
                        <option value="Cultural">Cultural / Festival</option>
                        <option value="Community">Community Service</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="eventCapacity">Capacity (Attendees)</label>
                    <input type="number" id="eventCapacity" placeholder="50" min="0">
                    <small style="color: #666; font-size: 13px;">Maximum number of participants</small>
                </div>
            </div>

            <div class="form-group">
                <label for="eventDescription">Description</label>
                <textarea id="eventDescription" placeholder="Brief description of the event..."></textarea>
            </div>

            <div class="form-group">
                <label for="eventImage">Event Image</label>
                <input type="file" id="eventImage" accept="image/*">
                <small style="color: #666; font-size: 13px;">Upload a JPG or PNG image for the event (optional)</small>
                <div id="imagePreview" style="margin-top: 12px; display: none;">
                    <img id="previewImg" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                </div>
            </div>

            <div class="form-group">
                <label for="registrationLink">Registration Link (Google Form or external)</label>
                <input type="url" id="registrationLink" placeholder="https://forms.gle/xxxxxx">
                <small style="color: #666; font-size: 13px;">Paste the Google Form link here so youth can register.</small>
            </div>

            <div class="form-group">
                <label for="eventStatus">Status</label>
                <select id="eventStatus">
                    <option value="Upcoming">Upcoming</option>
                    <option value="Ongoing">Ongoing</option>
                    <option value="Past">Past</option>
                </select>
            </div>

            <button type="submit" class="btn-submit">Save Event</button>
        </form>
    </div>
</div>

<!-- View Event Modal -->
<div class="modal" id="viewEventModal">
    <div class="modal-content">
        <span class="close-modal" id="closeViewEvent">√ó</span>
        <h2>Event Details</h2>

        <div id="eventDetails" class="event-details"></div>

        <div style="margin-top: 24px;">
            <a id="viewRegLink" href="#" target="_blank" class="btn-add-event" style="display: inline-flex; text-decoration: none;">
                <i class="fas fa-external-link-alt"></i> Open Registration Form
            </a>
        </div>
    </div>
</div>

<!-- Toast Notification Container -->
<div id="toastContainer"></div>

<!-- Confirmation Modal -->
<div class="modal" id="confirmationModal">
    <div class="modal-content" style="max-width: 420px;">
        <h2 style="margin-bottom: 12px; color: #E74C3C;">
            <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i> Confirm Action
        </h2>
        <p id="confirmMessage" style="color: #666; margin: 0 0 28px 0; font-size: 15px; line-height: 1.5;"></p>
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button id="confirmCancelBtn" class="btn-add-event" style="background: #95A5A6; margin: 0; padding: 10px 24px;">
                Cancel
            </button>
            <button id="confirmOkBtn" class="btn-add-event" style="background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%); margin: 0; padding: 10px 24px;">
                <i class="fas fa-trash" style="margin-right: 6px;"></i> Delete
            </button>
        </div>
    </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Toast Notification
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showAlert(message, type = 'info') {
    const container = document.getElementById('toastContainer');
    
    let icon = '‚úì';
    if (type === 'error') {
        icon = '‚ùå';
    } else if (type === 'warning') {
        icon = '‚ö†Ô∏è';
    } else if (type === 'info') {
        icon = '‚ÑπÔ∏è';
    }
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <span class="toast-icon">${icon}</span>
        <span class="toast-message">${message}</span>
    `;
    
    container.appendChild(toast);
    
    // Auto-remove after 4 seconds
    setTimeout(() => {
        toast.classList.add('removing');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 4000);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Confirmation Modal
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showConfirm(message, onConfirm) {
    const confirmModal = document.getElementById('confirmationModal');
    const confirmMessage = document.getElementById('confirmMessage');
    const confirmOkBtn = document.getElementById('confirmOkBtn');
    const confirmCancelBtn = document.getElementById('confirmCancelBtn');
    
    confirmMessage.textContent = message;
    confirmModal.style.display = 'flex';
    
    confirmOkBtn.onclick = () => {
        confirmModal.style.display = 'none';
        if (onConfirm) onConfirm();
    };
    
    confirmCancelBtn.onclick = () => {
        confirmModal.style.display = 'none';
    };
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Live date & time
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateDashboardDateTime() {
    const el = document.getElementById('dashboard-datetime');
    if (!el) return;
    const now = new Date();
    const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    el.textContent = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()} ‚Ä¢ ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
}
setInterval(updateDashboardDateTime, 1000);
updateDashboardDateTime();

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Load user profile dynamically
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadUserProfile() {
    try {
        const response = await fetch('api/get_user_profile.php');
        const result = await response.json();
        
        if (result.success) {
            const user = result.user;
            document.getElementById('userAvatarInitials').textContent = user.initials;
            document.getElementById('userFullName').textContent = user.name;
            document.getElementById('userRole').textContent = user.role;
        } else {
            console.error('Error loading user profile:', result.error);
            // Fallback to defaults if not logged in
            document.getElementById('userFullName').textContent = 'Guest User';
        }
    } catch (error) {
        console.error('Error fetching user profile:', error);
    }
}
loadUserProfile();

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Data & Storage - Using MySQL API
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let eventsData = [];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Load events from API
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadEvents() {
    try {
        const response = await fetch('api/get_events.php');
        const result = await response.json();
        
        if (result.success) {
            eventsData = result.data || [];
            renderEventsTable();
            filterEvents();
        } else {
            console.error('Failed to load events:', result.error);
            showAlert('Error loading events: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error fetching events:', error);
        alert('Error loading events from server');
    }
}

// Render table
function renderEventsTable(filtered = eventsData) {
    const tbody = document.getElementById('eventsTableBody');
    tbody.innerHTML = '';

    filtered.forEach(event => {
        const dateTime = new Date(`${event.date}T${event.time}`);
        const statusClass = {
            Upcoming: 'status-upcoming',
            Ongoing: 'status-ongoing',
            Past: 'status-past'
        }[event.status] || '';

        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td style="font-family: 'JetBrains Mono', monospace; font-weight: 600;">${event.id}</td>
            <td style="font-weight: 600;">${event.title}</td>
            <td>${dateTime.toLocaleDateString('en-US', {month:'long', day:'numeric', year:'numeric'})} ‚Ä¢ ${event.time}</td>
            <td>${event.location}</td>
            <td>${event.type}</td>
            <td><span class="status-badge ${statusClass}">${event.status}</span></td>
            <td>
                ${event.regLink ? `<a href="${event.regLink}" target="_blank" style="color:#228B57;">Google Form</a>` : '‚Äî'}
            </td>
            <td class="action-buttons">
                <button class="action-btn btn-view" onclick="viewEvent('${event.id}')" title="View Details">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="action-btn btn-edit" onclick="editEvent('${event.id}')" title="Edit Event">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn btn-delete" onclick="deleteEvent('${event.id}')" title="Delete Event">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Search & Filter
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterEvents() {
    const search = document.getElementById('searchInput').value.toLowerCase().trim();
    const status = document.getElementById('filterStatus').value;

    const filtered = eventsData.filter(e => {
        const text = `${e.id} ${e.title} ${e.location} ${e.type}`.toLowerCase();
        return text.includes(search) && (!status || e.status === status);
    });

    renderEventsTable(filtered);
}

document.getElementById('searchInput')?.addEventListener('input', filterEvents);
document.getElementById('filterStatus')?.addEventListener('change', filterEvents);

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Modal Controls
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const addEventModal = document.getElementById('addEventModal');
const viewEventModal = document.getElementById('viewEventModal');

document.getElementById('addEventBtn').onclick = () => {
    document.getElementById('eventModalTitle').textContent = "Add New Event";
    document.getElementById('eventForm').reset();
    document.getElementById('editEventId').value = "";
    document.getElementById('imagePreview').style.display = 'none';
    addEventModal.style.display = 'flex';
};

// Image preview when file is selected
document.getElementById('eventImage').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
            document.getElementById('previewImg').src = event.target.result;
            document.getElementById('imagePreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        document.getElementById('imagePreview').style.display = 'none';
    }
});

document.getElementById('closeEventModal').onclick = () => addEventModal.style.display = 'none';
document.getElementById('closeViewEvent').onclick = () => viewEventModal.style.display = 'none';

window.onclick = e => {
    if (e.target.classList.contains('modal')) e.target.style.display = 'none';
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Save / Edit Event
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('eventForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const editId = document.getElementById('editEventId').value;
    
    const formData = new FormData();
    formData.append('title', document.getElementById('eventTitle').value.trim());
    formData.append('date', document.getElementById('eventDate').value);
    formData.append('startTime', document.getElementById('eventStartTime').value);
    formData.append('endTime', document.getElementById('eventEndTime').value);
    formData.append('location', document.getElementById('eventLocation').value.trim());
    formData.append('type', document.getElementById('eventType').value);
    formData.append('capacity', document.getElementById('eventCapacity').value || 0);
    formData.append('description', document.getElementById('eventDescription').value.trim());
    formData.append('regLink', document.getElementById('registrationLink').value.trim());
    formData.append('status', document.getElementById('eventStatus').value);
    
    // Add image file if selected
    const fileInput = document.getElementById('eventImage');
    if (fileInput.files && fileInput.files[0]) {
        formData.append('image', fileInput.files[0]);
    }

    try {
        let response;
        let endpoint;
        
        if (editId) {
            // Update existing event
            formData.append('id', editId);
            endpoint = 'api/update_event.php';
        } else {
            // Add new event
            endpoint = 'api/add_event.php';
        }
        
        response = await fetch(endpoint, {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Reload events from server
            await loadEvents();
            addEventModal.style.display = 'none';
            document.getElementById('eventForm').reset();
            document.getElementById('imagePreview').style.display = 'none';
            showAlert(`Event ${editId ? 'updated' : 'added'} successfully!`, 'success');
        } else {
            showAlert('Error: ' + result.error, 'error');
        }
    } catch (error) {
        console.error('Error saving event:', error);
        showAlert('Error saving event: ' + error.message, 'error');
    }
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Edit Event
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function editEvent(id) {
    const event = eventsData.find(e => e.id === id);
    if (!event) {
        showAlert('Event not found', 'error');
        return;
    }

    document.getElementById('eventModalTitle').textContent = "Edit Event";
    document.getElementById('editEventId').value = event.id;

    document.getElementById('eventTitle').value = event.title;
    document.getElementById('eventDate').value = event.date;
    document.getElementById('eventStartTime').value = event.time;
    document.getElementById('eventEndTime').value = event.endTime || '';
    document.getElementById('eventLocation').value = event.location;
    document.getElementById('eventType').value = event.type;
    document.getElementById('eventCapacity').value = event.capacity || '';
    document.getElementById('eventDescription').value = event.description || '';
    document.getElementById('registrationLink').value = event.regLink || '';
    document.getElementById('eventStatus').value = event.status;
    
    // Show existing image if available
    if (event.imagePath) {
        document.getElementById('previewImg').src = event.imagePath;
        document.getElementById('imagePreview').style.display = 'block';
    } else {
        document.getElementById('imagePreview').style.display = 'none';
    }

    addEventModal.style.display = 'flex';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Delete Event
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function deleteEvent(id) {
    showConfirm('Delete this event?', async () => {
        try {
            const response = await fetch('api/delete_event.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id })
            });
            
            const result = await response.json();
            
            if (result.success) {
                await loadEvents();
                showAlert('Event deleted successfully', 'success');
            } else {
                showAlert('Error: ' + result.error, 'error');
        }
        } catch (error) {
            console.error('Error deleting event:', error);
            showAlert('Error deleting event: ' + error.message, 'error');
        }
    });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// View Event
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function viewEvent(id) {
    const event = eventsData.find(e => e.id === id);
    if (!event) {
        showAlert('Event not found', 'error');
        return;
    }

    const dateTime = new Date(`${event.date}T${event.time}`).toLocaleString('en-US', {
        month: 'long', day: 'numeric', year: 'numeric', hour: 'numeric', minute: '2-digit'
    });

    let html = `
        ${event.imagePath ? `<div style="margin-bottom: 20px; text-align: center;"><img src="${event.imagePath}" style="max-width: 100%; max-height: 300px; border-radius: 8px;"></div>` : ''}
        <p><strong>Event ID:</strong> ${event.id}</p>
        <p><strong>Title:</strong> ${event.title}</p>
        <p><strong>Date & Time:</strong> ${dateTime}${event.endTime ? ` - ${event.endTime}` : ''}</p>
        <p><strong>Location:</strong> ${event.location}</p>
        <p><strong>Type:</strong> ${event.type}</p>
        <p><strong>Status:</strong> ${event.status}</p>
        ${event.capacity ? `<p><strong>Capacity:</strong> ${event.capacity} participants</p>` : ''}
        <p><strong>Description:</strong> ${event.description || 'No description'}</p>
        ${event.regLink ? `<p><strong>Registration Link:</strong> <a href="${event.regLink}" target="_blank">Open Registration Form</a></p>` : ''}
    `;

    document.getElementById('eventDetails').innerHTML = html;
    viewEventModal.style.display = 'flex';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Initial load
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Setup events table on first load
fetch('api/setup_events_table.php').catch(() => {});

// Load events from API
loadEvents();
</script>
</body>
</html>